<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite PUBLIC "-//tuckey.org//DTD UrlRewrite 4.0//EN"
  "http://www.tuckey.org/res/dtds/urlrewrite4.0.dtd">

<urlrewrite>

  <rule>
    <from casesensitive="true">^([^?]*)\.seam(\?.*)?$</from>
    <to>$1.xhtml$2</to>
  </rule>

  <!-- Disable the Red Hat crawler -->
  <rule>
    <condition name="remote-addr">66.187.233.202</condition>
    <from>.*</from>
    <to last="true" type="temporary-redirect">/robots.txt</to>
  </rule>

  <!-- Disable anything that comes out of Microsoft -->
  <rule>
    <condition name="remote-addr">65.55.210.81</condition>
    <from>.*</from>
    <to last="true" type="temporary-redirect">/robots.txt</to>
  </rule>

  <!-- Dashboard Rules -->
  <rule>
    <from casesensitive="true">^/dashboard(/([^?]*)\??(.*))?$</from>
    <to last="true">/dashboard/home.xhtml$3</to>
  </rule>

  <!-- Search Rules -->
  <rule>
    <from casesensitive="true">^/search/([^/]+)/([^/]+)?$</from>
    <to last="true">/search.xhtml\?query=$1</to>
  </rule>

  <!-- Admin Rules -->
  <rule>
    <from casesensitive="true">^/admin/([^/\?\.]+)(\?.*)?$</from>
    <to last="true">/admin/$1.xhtml$2</to>
  </rule>


  <!-- Language rules -->
  <rule>
    <from casesensitive="true">^/language/view/([^/]+)(/([^?]*)\??(.*))?$</from>
    <to last="true">/language/language.xhtml\?id=$1&amp;$4</to>
  </rule>

  <rule>
    <from casesensitive="true">^/language/list(.+)?$</from>
    <to last="true">/language/home.xhtml$1</to>
  </rule>

  <!-- Project Rules -->

  <rule>
    <from casesensitive="true">^/project/add_iteration/([^/]+)/([^/]+)?$</from>
    <to last="true">/project/add_iteration.xhtml\?projectSlug=$1&amp;copyFromVersionSlug=$2</to>
  </rule>

  <rule>
    <from casesensitive="true">^/project/create(.+)$</from>
    <to last="true">/project/create_project.xhtml?$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/project/view/([^/]+)(/([^?]*)\??(.*))?$</from>
    <to
      last="true">/project/project.xhtml\?slug=$1&amp;$4
    </to>
  </rule>


  <!-- Project Iteration Rules -->
  <rule>
    <from casesensitive="true">^/iteration/view/([^/]+)/([^/]+)(/([^?]*)\??(.*))?$
    </from>
    <to
      last="true">/iteration/view.xhtml\?projectSlug=$1&amp;iterationSlug=$2&amp;$4
    </to>
  </rule>



  <rule>
    <from casesensitive="true">^/iteration/source_files/([^/]+)/([^/]+)/?$
    </from>
    <to type="permanent-redirect"
      last="true">%{context-path}/iteration/view/$1/$2&amp;#documents
    </to>
  </rule>

  <rule>
    <from casesensitive="true">^/iteration/files/([^/]+)/([^/]+)/([^/]+)/?$
    </from>
    <to type="permanent-redirect"
      last="true">%{context-path}/iteration/view/$1/$2&amp;#documents
    </to>
  </rule>

  <!-- zanata.xml -->
  <rule>
    <from casesensitive="true">^/project/view/([^/]+)/iter/([^/]+)/config/?$
    </from>
    <to
      last="true">/project/project.xhtml\?projectSlug=$1&amp;iterationSlug=$2&amp;actionMethod=project%2Fproject.xhtml%3AconfigurationAction.getData
    </to>
  </rule>

  <rule>
    <from casesensitive="true">^/project/list(.+)?$</from>
    <to last="true">/project/home.xhtml$1</to>
  </rule>

  <!-- account / -->

  <rule>
    <from casesensitive="true">^/account/sign_in(.+)?$</from>
    <to last="true">/account/login.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/klogin(\?.+)?$</from>
    <to last="true">/account/klogin.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/sign_out(.+)?$</from>
    <to last="true">/account/logout.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/register(.+)?$</from>
    <to last="true">/account/register.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/activate/(.+)$</from>
    <to last="true">/account/activate.xhtml\?key=$1</to>
  </rule>
  <rule>
    <from casesensitive="true">^/account/activate(.+)?$</from>
    <to last="true">/account/activate.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/validate_email/([^?]*)(.*)$</from>
    <to last="true">/account/email_validation.xhtml\?key=$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/changepassword(.+)?$</from>
    <to last="true">/account/changepassword.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/password_reset_request(.+)?$</from>
    <to last="true">/account/password_reset_request.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/password_reset/(.+)$</from>
    <to last="true">/account/password_reset.xhtml\?key=$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/google_password_reset_request(.+)?$</from>
    <to last="true">/account/google_password_reset_request.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/inactive(.+)?$</from>
    <to last="true">/account/inactive_account.xhtml$1</to>
  </rule>

  <!-- Profile -->
  <rule>
    <from casesensitive="true">^/profile/edit(.+)?$</from>
    <to last="true">/profile/edit.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/create(.+)?$</from>
    <to last="true">/profile/create_user.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/add_identity(\?.*)?$</from>
    <to last="true">/profile/add_identity.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/merge_account(\?.*)?$</from>
    <to last="true">/profile/merge_account.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/view/(.+)$</from>
    <to
      last="true">/profile/home.xhtml\?username=$1
    </to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/$</from>
    <to last="true">/profile/home.xhtml</to>
  </rule>

  <!-- Translation Memory -->
  <rule>
    <from casesensitive="true">^/tm/?(\?.*)?$</from>
    <to last="true">/tm/home.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/tm/create(\?.*)?$</from>
    <to last="true">/tm/create.xhtml$1</to>
  </rule>

  <!-- ROOT / -->
  <rule>
    <from>^/$</from>
    <to>/home.xhtml</to>
  </rule>

  <rule>
    <from>^/admin/$</from>
    <to>/admin/home.xhtml</to>
  </rule>

  <rule>
    <from>^/error(\?.+)?$</from>
    <to>/error.xhtml$1</to>
  </rule>


  <!-- Rest Mappings -->

  <rule>
    <from casesensitive="true">^/rest/$</from>
    <to last="true">/rest/index.xrd</to>
  </rule>

  <rule>
    <from casesensitive="true">^/seam/resource/restv1/(.+)$</from>
    <to last="true">/rest/$1</to>
  </rule>

  <!-- Version group -->

  <rule>
    <from casesensitive="true">^/version-group/create(.+)$</from>
    <to last="true">/version-group/create_version_group.xhtml?$1</to>
  </rule>


  <rule>
    <from casesensitive="true">^/version-group/list(.+)?$</from>
    <to last="true">/version-group/home.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/version-group/view/([^/]+)(/([^?]*)\??(.*))?$
    </from>
    <to
      last="true">/version-group/version_group.xhtml\?versionGroupSlug=$1&amp;$4
    </to>
  </rule>

  <!-- Glossary -->
  <!--   <rule> -->
  <!--     <from casesensitive="true">^/glossary/view(.+)?$</from> -->
  <!--     <to last="true">/glossary/view.xhtml$1</to> -->
  <!--   </rule> -->

  <!--  Editor workspace redirection from Application.html to Application.xhtml -->
  <rule>
    <from casesensitive="true">^/webtrans/Application.html(.*)$</from>
    <to last="true">/webtrans/Application.xhtml$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/webtrans/translate(.*)$</from>
    <to last="true">/webtrans/Application.xhtml$1</to>
  </rule>

  <!-- zanata-assets resource -->
  <!-- JSF serves zanata-assets with suffix of .xhtml,
      this is to make sure any reference to zanata-assets without .xhtml can access to the resource.
      e.g. jars/assets/style.css redirects to jars/assets/style.css.xhtml -->
  <rule>
    <from casesensitive="true">^/javax.faces.resource/jars/assets/(.*)(?&lt;!.xhtml)$</from>
    <to last="true">/javax.faces.resource/jars/assets/$1.xhtml</to>
  </rule>

  <outbound-rule>
    <from casesensitive="true">^([^?]*)\.seam(\?.*)?$</from>
    <to>$1.xhtml$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/dashboard/home.xhtml(.+)?$</from>
    <to>$1/dashboard/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/admin/(.+).xhtml(.*)$</from>
    <to>$1/admin/$2$3</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/language/language.xhtml\?id=(.+)$</from>
    <to>$1/language/view/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/language/home.xhtml(.+)?$</from>
    <to>$1/language/list$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/project/add_iteration.xhtml\?projectSlug=([^&amp;]+)(?:&amp;copyFromVersionSlug=([^&amp;]+))?(.+)?$</from>
    <to>$1/project/add_iteration/$2/$3</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/project/add_iteration.xhtml\?copyFromVersionSlug=([^&amp;]+)&amp;projectSlug=([^&amp;]+)(.+)?$</from>
    <to>$1/project/add_iteration/$3/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/project/create_project.xhtml(.+)?$</from>
    <to>$1/project/create/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/project/project.xhtml\?slug=(.+)$</from>
    <to>$1/project/view/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/project/project.xhtml\?projectSlug=([^&amp;]+)&amp;iterationSlug=([^&amp;]+)(?:&amp;slug=[^&amp;]+)?&amp;actionMethod=project%2Fproject\.xhtml%3AconfigurationAction\.getData.*$</from>
    <to>$1/project/view/$2/iter/$3/config</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/project/home.xhtml(.+)?$</from>
    <to>$1/project/list$2</to>
  </outbound-rule>

  <!-- repeated to handle either param order (there should be a better way to do this) -->
  <outbound-rule>
    <from>^(/.+)?/iteration/view.xhtml\?projectSlug=([^&amp;]+)&amp;iterationSlug=([^&amp;]+)(&amp;(.+))?$</from>
    <to>$1/iteration/view/$2/$3</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/iteration/view.xhtml\?iterationSlug=([^&amp;]+)&amp;projectSlug=([^&amp;]+)(&amp;(.+))?$</from>
    <to>$1/iteration/view/$3/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/account/login.xhtml(.+)?$</from>
    <to>$1/account/sign_in$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/klogin.xhtml(.+)?$</from>
    <to>$1/account/klogin$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/logout.xhtml(.+)?$</from>
    <to>$1/account/sign_out$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/register.xhtml(.+)?$</from>
    <to>$1/account/register$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/activate.xhtml\?key=(.+)$</from>
    <to>$1/account/activate/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/activate.xhtml(.+)?$</from>
    <to>$1/account/activate$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/email_validation.xhtml\?key=(.+)$</from>
    <to>$1/account/validate_email/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/password_reset_request.xhtml(.+)?$</from>
    <to>$1/account/password_reset_request$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/password_reset.xhtml\?key=(.+)$</from>
    <to>$1/account/password_reset/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/google_password_reset_request.xhtml(.+)?$</from>
    <to>$1/account/google_password_reset_request$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/inactive_account.xhtml(.+)?$</from>
    <to>$1/account/inactive$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/version-group/home.xhtml(.+)?$</from>
    <to>$1/version-group/list$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/version-group/create_version_group.xhtml(.+)?$</from>
    <to>$1/version-group/create/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/version-group/version_group.xhtml\?versionGroupSlug=(.+)$</from>
    <to>$1/version-group/view/$2</to>
  </outbound-rule>

  <!--   <outbound-rule> -->
  <!--     <from>^(/.+)?/glossary/view.xhtml(.+)?$</from> -->
  <!--     <to>$1/glossary/view$2</to> -->
  <!--   </outbound-rule> -->

  <outbound-rule>
    <from>^(/.+)?/profile/create_user.xhtml(.+)?$</from>
    <to>$1/profile/create$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/profile/merge_account.xhtml(.+)?$</from>
    <to>$1/profile/merge_account$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/profile/home.xhtml\?username=(.+)$</from>
    <to>$1/profile/view/$2</to>
  </outbound-rule>


  <outbound-rule>
    <from>^(/.+)?/tm/create.xhtml(.+)?$</from>
    <to>$1/tm/create$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/home.xhtml(.+)?$</from>
    <to>$1/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/help/view.xhtml(.+)?$</from>
    <to>$1/help/view$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/error.xhtml(.+)?$</from>
    <to>$1/error$2</to>
  </outbound-rule>

  <!--  Editor workspace redirection from Application.html to Application.xhtml -->
  <outbound-rule>
    <from>^(/.+)?/webtrans/Application.xhtml(.*)$</from>
    <to>$1/webtrans/translate$2</to>
  </outbound-rule>

  <!-- Removing .xhtml from rest url  -->
  <outbound-rule>
    <from>^(/.+)?/rest/file/translation/(.+).xhtml(.+)$</from>
    <to>$1/rest/file/translation/$2$3</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/rest/file/source/(.+).xhtml(.+)$</from>
    <to>$1/rest/file/source/$2$3</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/rest/tm/(.+).xhtml(.*)$</from>
    <to>$1/rest/tm/$2$3</to>
  </outbound-rule>

</urlrewrite>
